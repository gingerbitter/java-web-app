pipeline {
    agent any
tools{
    maven "Maven 3.8.6"
}
 options {
    buildDiscarder(logRotator(numToKeepStr: '5'))
  }
    stages {
        stage('Get Source code') {
            steps {
                echo 'Welcome to Jenkins pipeline'
                git 'https://github.com/gingerbitter/Aulas-webtestcases.git'
              
            }
        }
        stage('Build code'){
            steps {
            bat script: 'mvn compile'
        }
        }
         stage('Run Test'){
             steps {
            bat script: 'mvn test -Dbrowser=localchrome'
        }
         }
         
         stage('Scan') {
            steps {
               withSonarQubeEnv(installationName: 'sq1') { 
                   bat script: 'mvn org.sonarsource.scanner.maven:sonar-maven-plugin:3.7.0.1746:sonar'
        }
      }
    }
    stage("Quality Gate") {
      steps {
        timeout(time: 2, unit: 'MINUTES') {
          waitForQualityGate abortPipeline: true
          
        }
      }
    }
    stage('Email Notification'){
    emailext body: 'This is the emailable reports for the sonarqube http://localhost:9000/dashboard?id=Aulas%3AAulasCare   Thanks', compressLog: true, subject: 'Emailable Reports', to: 'nandini.priya@brigosha.com'
    } 
    }
}
